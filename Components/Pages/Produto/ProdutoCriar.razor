@page "/produtos/novo"
@rendermode InteractiveServer
@using AppWeb.Models
@inject ProdutoDAO produtoDAO
@inject NavigationManager Navigation

<PageTitle>Produto - Novo</PageTitle>

<h1 class="text-xl font-semibold text-gray-800 dark:text-gray-100 mb-6">Novo Produto</h1>

@if (erro is not null)
{
    <div class="alert alert-danger">
        @erro
    </div>
}

<EditForm Model="_novoProduto" OnSubmit="Salvar">
    <div class="mb-4">
        <label class="block">Nome</label>
        <input @bind-value="_novoProduto.Nome" type="text" class="form-control" placeholder="Informe o nome do produto" />
    </div>

    <div class="mb-4">
        <label class="block">Quantidade</label>
        <input @bind-value="_novoProduto.Quantidade" type="number" class="form-control" placeholder="Informe a quantidade" />
    </div>

    <div class="mb-4">
        <label class="block">Preço</label>
        <input @bind-value="_novoProduto.Valor" type="text" class="form-control" placeholder="Informe o preço" />
    </div>

    <div class="mb-4">
        <label class="block">Descrição</label>
        <input @bind-value="_novoProduto.Descricao" type="text" class="form-control" placeholder="Informe a descrição" />
    </div>

    <button type="submit" class="btn btn-primary">Salvar</button>
</EditForm>

@code {
    private Produto _novoProduto = new Produto();
    private string? erro;

    private void Salvar()
    {
        try
        {
            if (string.IsNullOrWhiteSpace(_novoProduto.Nome))
                throw new Exception("O campo nome é obrigatório");

            produtoDAO.Inserir(_novoProduto);

            Navigation.NavigateTo("/produto", forceLoad: true);
        }
        catch (Exception ex)
        {
            erro = ex.Message;
        }
    }
}
